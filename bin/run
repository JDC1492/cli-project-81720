#!/usr/bin/env ruby
require 'rest-client'
require 'json'
require 'pry'
require_relative '../lib/api'
require_relative '../lib/cli'
require_relative '../lib/plant'

#site information to pull, setting it to the resp var.
resp = RestClient.get('https://trefle.io/api/v1/plants?token=7jharOHxyyJNNnPiuAkMe0EvzCR_F7MQkHt0S-1__LM')
tref_hash = JSON.parse(resp.body, symbolize_names:true)
tref_array = tref_hash[:data]

plant_id = tref_array.collect do |plant|
    Plants.new(plant)
    
end
 
URL='https://trefle.io/'
token = '?token=7jharOHxyyJNNnPiuAkMe0EvzCR_F7MQkHt0S-1__LM'

plant_id.each do |p_id| 
    resp = RestClient.get(URL + p_id.link + token)
    id_hash = JSON.parse(resp.body, symbolize_names:true)
    binding.pry
    p_id.scientific_name = id_hash[:data][:scientific_name]
    p_id.genus = id_hash[:data][:genus]
    p_id.observations = id_hash[:data][:observations]
    p_id.family = id_hash[:data][:family]
    p_id.edible = id_hash[:data][:edible]
end


# CLI.new.greet